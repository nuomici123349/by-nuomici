<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Interactive Mobile Desktop</title>
    
    <!-- 默认字体链接 -->
    <div id="font-link-container">
        <link rel="preload" as="style" crossorigin
            href="https://fontsapi.zeoseven.com/309/main/result.css"
            onload="this.rel='stylesheet'"
            onerror="this.href='httpsapi-storage.zeoseven.com/309/main/result.css'" />
        <noscript>
            <link rel="stylesheet" href="https://fontsapi.zeoseven.com/309/main/result.css" />
        </noscript>
    </div>
    <!-- 动态字体样式注入点 -->
    <style id="dynamic-font-style"></style>

    <style>
        :root {
            --morandi-apple-green: #d4e6d6;
            --screen-bg: #f7f9f7;
            --text-color: #5a6e60;
            --text-light: #a2b0a5;
            --placeholder-bg: #e8f0e9;
            --dock-bg: rgba(232, 240, 233, 0.85);
            --font-main: "KingHwaOldSong", 'Songti SC', 'STSong', 'SimSun', serif;
            --battery-low: #e74c3c;
            --battery-charging: #34c759;
            --global-font-size: 16px; 
            --global-font-weight: 400;
        }

        html, body {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: var(--placeholder-bg);
            font-family: var(--font-main);
            color: var(--text-color);
            overflow: hidden;
            font-size: var(--global-font-size);
            font-weight: var(--global-font-weight);
            background-size: cover;
            background-repeat: no-repeat;
            background-position: center center;
            transition: background-image 0.3s ease-in-out, background-color 0.3s ease-in-out;
        }

        .app-container { width: 100%; height: 100%; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        .status-bar { padding: 15px 25px 10px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; box-sizing: border-box; position: absolute; top: 0; left: 0; right: 0; z-index: 200; }
        .status-bar-time { font-weight: 600; font-size: 15px; }
        .status-bar-right-icons { display: flex; align-items: flex-end; gap: 7px; position: relative; top: 1px; }
        .status-bar-right-icons svg { height: 13px; width: auto; }
        .status-bar-svg-icon path { fill: var(--text-color); }
        .battery-container { display: flex; align-items: center; height: 13px; position: relative; bottom: -0.5px; }
        .battery-frame { stroke: var(--text-color); stroke-width: 1px; fill: none; }
        .battery-terminal, .battery-fill { fill: var(--text-color); }
        .battery-low .battery-fill { fill: var(--battery-low); }
        .battery-low .battery-frame, .battery-low .battery-terminal { stroke: var(--battery-low); fill: var(--battery-low); }
        #battery-charging-bolt { display: none; }
        .battery-charging #battery-charging-bolt { display: block; }
        .battery-charging .battery-bolt-path { fill: #fff; }
        .battery-charging .battery-fill { fill: var(--battery-charging); display: block !important; }

        .page { display: none; flex-direction: column; width: 100%; height: 100%; flex-grow: 1; overflow: hidden; }
        .page.active { display: flex; }

        .main-content { flex-grow: 1; padding: 0 20px; display: flex; flex-direction: column; overflow-y: auto; }
        .main-content::-webkit-scrollbar { display: none; }

        .profile-card { position: relative; margin-top: 60px; flex-shrink: 0; background-color: #fff; border-radius: 20px; box-shadow: 0 8px 25px rgba(90, 110, 96, 0.1); }
        .profile-banner { height: 120px; background-color: var(--placeholder-bg); border-radius: 20px 20px 0 0; cursor: pointer; background-size: cover; background-position: center; }
        
        .avatar-frame { width: 85px; height: 85px; position: absolute; top: 120px; left: 50%; transform: translate(-50%, -55%); z-index: 10; display: flex; justify-content: center; align-items: center; }
        
        .avatar { 
            width: 75px; height: 75px; 
            background-color: #fff; 
            border-radius: 50%; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); 
            cursor: pointer; 
            transition: all 0.3s ease;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        .avatar:hover { transform: scale(1.05); }
        
        .avatar.avatar-framed {
            width: 65px;
            height: 65px;
        }
        
        #avatar-frame-overlay { position: absolute; width: 100%; height: 100%; top: 0; left: 0; border-radius: 50%; pointer-events: none; transition: background-image 0.3s, box-shadow 0.3s; background-size: contain; background-repeat: no-repeat; background-position: center; }
        
        .avatar-frame-preview { position: relative; width: 85px; height: 85px; margin: 20px auto; display: flex; justify-content: center; align-items: center; }
        #preview-avatar { position: relative; } 
        #preview-avatar-frame { position: absolute; width: 100%; height: 100%; top: 0; left: 0; border-radius: 50%; background-size: contain; background-repeat: no-repeat; background-position: center; }

        .profile-info { text-align: center; padding: 50px 15px 20px; }
        .profile-info .editable { cursor: pointer; }
        .profile-info .editable:hover { opacity: 0.7; }
        .profile-info .nickname, .profile-info .username, .profile-info .bio, .profile-info .location span { min-height: 1em; }
        .profile-info .nickname { font-size: 1.125em; font-weight: bold; margin: 0 0 4px; }
        .profile-info .username { font-size: 0.8125em; color: var(--text-light); margin: 0; }
        .profile-info .bio { font-size: 0.8125em; margin: 12px 0; letter-spacing: 1px; }
        .profile-info .location { display: inline-flex; align-items: center; gap: 5px; font-size: 0.75em; color: var(--text-light); background-color: var(--screen-bg); padding: 4px 10px; border-radius: 20px; margin-top: 5px; }
        .profile-info .location svg { width: 12px; height: 12px; flex-shrink: 0; }
        .middle-container { flex-grow: 1; display: flex; align-items: center; justify-content: center; min-height: 150px; }
        .main-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; align-items: stretch; height: 130px; width: 100%; flex-shrink: 0; }
        .widget-card-vertical { background-color: #fff; border-radius: 18px; cursor: pointer; background-size: cover; background-position: center; }
        .app-grid-right { display: grid; grid-template-columns: repeat(2, 1fr); grid-template-rows: repeat(2, 1fr); gap: 15px; }
        .app-icon { text-decoration: none; color: var(--text-color); display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 6px; transition: transform 0.2s ease; }
        .app-icon:hover { transform: scale(1.08); }
        .icon-placeholder { width: 75%; padding-top: 75%; position: relative; background-color: #fff; border-radius: 14px; background-size: cover; background-position: center; }
        .app-icon span { font-size: 0.6875em; }
        .dock { padding: 15px 20px; margin: 15px; background-color: var(--dock-bg); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-radius: 25px; display: flex; justify-content: space-around; align-items: center; flex-shrink: 0; transition: background-color 0.3s ease; }
        .dock-icon-placeholder { width: 50px; height: 50px; background-color: white; border-radius: 12px; cursor: pointer; background-size: cover; background-position: center; }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-overlay.visible { display: flex; }
        .modal-content { background: white; padding: 20px; border-radius: 15px; width: 80%; max-width: 300px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .modal-content h3 { margin-top: 0; color: var(--text-color); }
        .modal-input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-family: var(--font-main); margin-bottom: 15px; transition: border-color 0.2s, box-shadow 0.2s; }
        .modal-input:focus { outline: none; border-color: var(--placeholder-bg); box-shadow: 0 0 5px var(--placeholder-bg); }
        .modal-actions { display: flex; justify-content: flex-end; gap: 10px; }
        .modal-button { padding: 8px 15px; border: none; border-radius: 8px; cursor: pointer; font-family: var(--font-main); }
        .modal-button.save { background-color: var(--text-color); color: white; }
        .modal-button.cancel { background-color: #eee; }

        .app-header { padding: 10px 20px; display: flex; align-items: center; position: relative; text-align: center; flex-shrink: 0; margin-top: 45px; }
        .back-button { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); cursor: pointer; padding: 5px; }
        .back-button svg { width: 22px; height: 22px; }
        .app-title { flex-grow: 1; font-size: 1.125em; font-weight: bold; }
        .app-content-area { flex-grow: 1; padding: 15px 20px; overflow-y: auto; }
        .app-content-area::-webkit-scrollbar { display: none; }

        .setting-card { background-color: #fff; border-radius: 15px; padding: 18px 20px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; box-shadow: 0 4px 15px rgba(90, 110, 96, 0.08); transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .setting-card:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(90, 110, 96, 0.12); }
        .setting-card span { font-size: 0.9375em; }
        .setting-card .arrow { color: var(--text-light); font-size: 1.125em; }
        
        .settings-section { background-color: #fff; border-radius: 15px; padding: 15px 20px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(90, 110, 96, 0.08); }
        .settings-section h3 { font-size: 1em; margin: 0 0 15px 0; border-bottom: 1px solid var(--placeholder-bg); padding-bottom: 10px; }
        .control-group { margin-bottom: 15px; }
        .control-group:last-child { margin-bottom: 5px; }
        .control-group label { display: block; font-size: 0.875em; margin-bottom: 8px; color: var(--text-light); }
        .btn { display: block; width: 100%; padding: 10px; background-color: var(--placeholder-bg); border: none; border-radius: 8px; font-family: var(--font-main); color: var(--text-color); font-size: 0.9375em; cursor: pointer; text-align: center; }
        .input-field, .textarea-field, .select-field { width: 100%; padding: 10px; border: 1px solid #e0e0e0; border-radius: 8px; box-sizing: border-box; font-family: var(--font-main); font-size: 0.875em; background-color: #fdfdfd; }
        .textarea-field { resize: vertical; min-height: 150px; white-space: pre; overflow-wrap: normal; overflow-x: scroll; }
        .slider-container { display: flex; align-items: center; gap: 15px; }
        .slider-container span { font-size: 0.875em; color: var(--text-light); }
        input[type="range"] { flex-grow: 1; -webkit-appearance: none; appearance: none; width: 100%; height: 5px; background: var(--placeholder-bg); border-radius: 5px; outline: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 18px; height: 18px; background: var(--text-color); border-radius: 50%; cursor: pointer; }
        input[type="range"]::-moz-range-thumb { width: 18px; height: 18px; background: var(--text-color); border-radius: 50%; cursor: pointer; }
        .preview-box { background-color: var(--placeholder-bg); padding: 20px; border-radius: 10px; text-align: center; }
        .preview-box p { margin: 0; }
        #font-preview { font-size: 1.5em; font-weight: bold; margin-bottom: 10px !important; }
        #font-details { font-size: 0.8em; color: var(--text-light); }
        
        #wallpaper-preview, #lockscreen-wallpaper-preview { width: 140px; height: 280px; margin: 0 auto; background-color: var(--placeholder-bg); border-radius: 15px; border: 3px solid #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.1); background-size: cover; background-repeat: no-repeat; background-position: center; transition: background-image 0.3s ease-in-out; display: flex; justify-content: center; align-items: center; color: var(--text-light); font-size: 0.9em; }
        .settings-section label.toggle-label { display: flex; align-items: center; justify-content: space-between; cursor: pointer; font-size: 0.9375em; margin-bottom: 10px; padding: 10px 0; }
        .settings-section label.toggle-label input[type="checkbox"] { width: 18px; height: 18px; cursor: pointer; }
        
        .icon-setting-group { margin-bottom: 25px; }
        .icon-setting-group h4 { font-size: 0.9em; margin: 0 0 10px; color: var(--text-color); border-bottom: 1px solid var(--placeholder-bg); padding-bottom: 8px; }
        .icon-setting-group .control-group { display: flex; gap: 10px; }
        .icon-setting-group .control-group .btn { width: auto; flex-grow: 1; }
        .icon-setting-group .control-group .input-field { width: auto; flex-grow: 2; }
        
        .btn-restore { background-color: #e8e8e8; margin-top: 10px; }

        #theme-color-preview { width: 80px; height: 80px; border-radius: 50%; background-color: var(--placeholder-bg); border: 4px solid #fff; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transition: background-color 0.3s; margin: 0 auto 20px; }
        #theme-color-hex { font-family: monospace; text-transform: uppercase; text-align: center; }

        /* --- 锁屏新增样式 --- */
        #lock-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10000;
            background-color: #ffffff;
            background-size: cover;
            background-position: center;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 80px 0 40px;
            box-sizing: border-box;
            opacity: 1;
            visibility: visible;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        #lock-screen.hidden { opacity: 0; visibility: hidden; }

        .lock-screen-content { text-align: center; text-shadow: 0 2px 5px rgba(0,0,0,0.4); }
        #lock-screen-time { font-size: 5.5em; font-weight: 700; }
        #lock-screen-date { font-size: 1.25em; font-weight: 400; margin-top: 5px; }
        .lock-screen-unlock-hint { font-size: 1.1em; font-weight: 500; text-shadow: 0 1px 3px rgba(0,0,0,0.3); animation: slide-up-hint 2s infinite ease-out; }

        @keyframes slide-up-hint { 0%, 100% { opacity: 0.8; transform: translateY(0); } 50% { opacity: 1; transform: translateY(-8px); } }

        #passcode-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 9999;
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        #passcode-screen.visible { opacity: 1; visibility: visible; }
        #passcode-screen.shake .passcode-dots { animation: shake-anim 0.5s; }
        @keyframes shake-anim { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); } 20%, 40%, 60%, 80% { transform: translateX(8px); } }

        .passcode-container { text-align: center; }
        .passcode-title { font-size: 1.25em; color: #333; font-weight: 500; margin-bottom: 20px; }
        .passcode-dots { display: flex; gap: 20px; margin-bottom: 60px; }
        .passcode-dot { width: 15px; height: 15px; border-radius: 50%; border: 1.5px solid #555; transition: background-color 0.2s; }
        .passcode-dot.filled { background-color: #333; border-color: #333; }

        .passcode-keyboard { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .keyboard-btn {
            width: 75px; height: 75px; border-radius: 50%;
            background-color: rgba(200, 200, 200, 0.4);
            border: none;
            font-size: 2em; color: #111;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: background-color 0.2s;
        }
        .keyboard-btn:active { background-color: rgba(180, 180, 180, 0.6); }
        .keyboard-btn.delete { font-size: 1.2em; }
    </style>
</head>
<body>

    <div class="app-container">
        <header class="status-bar">
            <div class="status-bar-time" id="current-time"></div>
            <div class="status-bar-right-icons">
                <svg class="status-bar-svg-icon" width="20" height="13" viewBox="-1 -1 22 15" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M18.8186 0.749817H17.6519C17.0076 0.749817 16.4852 1.2535 16.4852 1.87482V11.6248C16.4852 12.2461 17.0076 12.7498 17.6519 12.7498H18.8186C19.4629 12.7498 19.9852 12.2461 19.9852 11.6248V1.87482C19.9852 1.2535 19.4629 0.749817 18.8186 0.749817ZM12.1617 3.37495H13.3284C13.9727 3.37495 14.495 3.87863 14.495 4.49995V11.625C14.495 12.2463 13.9727 12.75 13.3284 12.75H12.1617C11.5174 12.75 10.995 12.2463 10.995 11.625V4.49995C10.995 3.87863 11.5174 3.37495 12.1617 3.37495ZM7.83818 5.99974H6.67151C6.02718 5.99974 5.50484 6.50342 5.50484 7.12474V11.6247C5.50484 12.2461 6.02718 12.7497 6.67151 12.7497H7.83818C8.48251 12.7497 9.00484 12.2461 9.00484 11.6247V7.12474C9.00484 6.50342 8.48251 5.99974 7.83818 5.99974ZM2.34798 8.2497H1.18132C0.536983 8.2497 0.0146484 8.75338 0.0146484 9.3747V11.6247C0.0146484 12.246 0.536983 12.7497 1.18132 12.7497H2.34798C2.99231 12.7497 3.51465 12.246 3.51465 11.6247V9.3747C3.51465 8.75338 2.99231 8.2497 2.34798 8.2497Z"></path></svg>
                <svg class="status-bar-svg-icon" viewBox="0 0 18 13" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.00047 2.59599C11.467 2.5961 13.8393 3.56668 15.6269 5.30712C15.7615 5.44149 15.9766 5.43979 16.1092 5.30332L17.396 3.9734C17.4631 3.90418 17.5006 3.81042 17.5 3.71287C17.4994 3.61531 17.4609 3.52201 17.393 3.4536C12.7011 -1.1512 5.29908 -1.1512 0.607163 3.4536C0.539197 3.52196 0.500634 3.61523 0.500008 3.71279C0.499381 3.81034 0.536742 3.90413 0.603824 3.9734L1.89096 5.30332C2.02346 5.44 2.23878 5.4417 2.37331 5.30712C4.16116 3.56656 6.53367 2.59598 9.00047 2.59599ZM9.00045 6.92266C10.3557 6.92257 11.6625 7.43843 12.6671 8.36999C12.8029 8.5022 13.017 8.49933 13.1494 8.36353L14.4347 7.03361C14.5024 6.96386 14.5399 6.86922 14.539 6.77089C14.538 6.67255 14.4986 6.57872 14.4295 6.51039C11.3704 3.59629 6.63306 3.59629 3.57399 6.51039C3.50489 6.57872 3.46546 6.6726 3.46455 6.77097C3.46365 6.86933 3.50133 6.96396 3.56916 7.03361L4.85407 8.36353C4.98652 8.49933 5.20056 8.5022 5.33643 8.36999C6.34032 7.43905 7.64613 6.92323 9.00045 6.92266ZM11.5751 9.83398C11.5771 9.93259 11.5392 10.0277 11.4705 10.0968L9.24719 12.3945C9.18201 12.462 9.09316 12.5 9.00045 12.5C8.90773 12.5 8.81888 12.462 8.7537 12.3945L6.53006 10.0968C6.46137 10.0276 6.42358 9.93251 6.42562 9.8339C6.42765 9.73529 6.46933 9.64191 6.54082 9.57581C7.96068 8.34595 10.0402 8.34595 11.4601 9.57581C11.5315 9.64196 11.5731 9.73537 11.5751 9.83398Z"></path></svg>
                <div class="battery-container" id="battery-container">
                    <svg width="28" height="13" viewBox="0 0 28 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect class="battery-frame" opacity="0.4" x="1.17004" y="0.5" width="24" height="12" rx="3.5"></rect>
                        <path class="battery-terminal" opacity="0.5" d="M26.67 4.5V8.5C27.476 8.16122 28 7.37313 28 6.5C28 5.62687 27.476 4.83878 26.67 4.5Z"></path>
                        <rect class="battery-fill" id="battery-fill" x="2.17004" y="2" width="22" height="9" rx="2"></rect>
                        <g id="battery-charging-bolt"><path d="M512 393.216 229.376 512 430.08 512 471.04 630.784 753.664 512 552.96 512Z" class="battery-bolt-path" transform="translate(13.5, 6.5) scale(0.022) translate(-491.5, -512)"/></g>
                    </svg>
                </div>
            </div>
        </header>

        <!-- 桌面页面 -->
        <div id="desktop-page" class="page active">
            <main class="main-content">
                <div class="profile-card">
                    <div class="profile-banner" id="profile-banner"></div>
                    <input type="file" id="banner-upload" accept="image/*" style="display: none;">
                    <div class="avatar-frame">
                        <div class="avatar" id="avatar-container"></div>
                        <div id="avatar-frame-overlay"></div>
                    </div>
                    <input type="file" id="avatar-upload" accept="image/*" style="display: none;">
                    <div class="profile-info">
                        <h1 class="nickname editable">点击编辑昵称</h1>
                        <p class="username editable">点击编辑ID</p>
                        <p class="bio editable">点击编辑签名</p>
                        <div class="location">
                            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path></svg>
                            <span class="editable">点击编辑地点</span>
                        </div>
                    </div>
                </div>
                <div class="middle-container">
                    <section class="main-layout">
                        <div class="widget-card-vertical" id="widget-left"></div>
                        <input type="file" id="widget-left-upload" accept="image/*" style="display: none;">
                        <div class="app-grid-right">
                            <a href="#" class="app-icon"><div class="icon-placeholder" id="app-icon-1"></div><span>App 1</span></a>
                            <a href="#" class="app-icon"><div class="icon-placeholder" id="app-icon-2"></div><span>App 2</span></a>
                            <a href="#" class="app-icon"><div class="icon-placeholder" id="app-icon-3"></div><span>App 3</span></a>
                            <a href="#" class="app-icon"><div class="icon-placeholder" id="app-icon-4"></div><span>App 4</span></a>
                        </div>
                    </section>
                </div>
            </main>
            <footer class="dock">
                <a href="javascript:void(0);" class="dock-icon" id="beautify-app-icon"><div class="dock-icon-placeholder" id="dock-icon-1"></div></a>
                <a href="#" class="dock-icon"><div class="dock-icon-placeholder" id="dock-icon-2"></div></a>
                <a href="#" class="dock-icon"><div class="dock-icon-placeholder" id="dock-icon-3"></div></a>
                <a href="#" class="dock-icon"><div class="dock-icon-placeholder" id="dock-icon-4"></div></a>
            </footer>
        </div>

        <!-- 美化页面 -->
        <div id="beautify-page" class="page">
            <header class="app-header">
                <div class="back-button" id="beautify-back-button"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></svg></div>
                <h2 class="app-title">美化</h2>
            </header>
            <div class="app-content-area">
                <div class="setting-card" id="font-settings-card"><span>字体设置</span><span class="arrow">></span></div>
                <div class="setting-card" id="wallpaper-settings-card"><span>自定义壁纸/锁屏</span><span class="arrow">></span></div>
                <div class="setting-card" id="theme-settings-card"><span>主题色设置</span><span class="arrow">></span></div>
                <div class="setting-card" id="avatar-frame-settings-card"><span>头像框设置</span><span class="arrow">></span></div>
                <div class="setting-card" id="icon-settings-card"><span>图标设置</span><span class="arrow">></span></div>
                <div class="setting-card" id="dock-settings-card"><span>底部栏</span><span class="arrow">></span></div>
            </div>
        </div>
        
        <!-- 字体设置页面 -->
        <div id="font-settings-page" class="page">
            <header class="app-header">
                <div class="back-button" id="font-settings-back-button"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></svg></div>
                <h2 class="app-title">字体设置</h2>
            </header>
            <div class="app-content-area">
                <div class="settings-section">
                    <h3>字体种类</h3>
                    <div class="control-group">
                        <button class="btn" id="upload-font-btn">上传本地字体文件</button>
                        <input type="file" id="font-file-input" accept=".ttf,.otf,.woff,.woff2" style="display:none;">
                    </div>
                    <div class="control-group">
                        <label for="font-css-input">导入CSS代码</label>
                        <textarea id="font-css-input" class="textarea-field"></textarea>
                    </div>
                    <div class="control-group">
                        <label for="font-url-input">输入字体文件URL</label>
                        <input type="text" id="font-url-input" class="input-field" placeholder="https://.../font.ttf">
                    </div>
                </div>
                <div class="settings-section">
                    <h3>字体大小/粗细</h3>
                    <div class="control-group">
                        <label>大小</label>
                        <div class="slider-container">
                            <span>A</span>
                            <input type="range" id="font-size-slider" min="12" max="20" step="1" value="16">
                            <span style="font-size: 1.25em;">A</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label>粗细</label>
                        <div class="slider-container">
                            <span>细</span>
                            <input type="range" id="font-weight-slider" min="100" max="900" step="100" value="400">
                            <span style="font-weight: bold;">粗</span>
                        </div>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>实时预览</h3>
                    <div class="preview-box">
                        <p id="font-preview">你好世界 Hello World</p>
                        <p id="font-details">京华老宋体 / 16px / 400</p>
                    </div>
                </div>
                <div class="settings-section">
                    <button class="btn btn-restore" id="restore-font-defaults">恢复默认</button>
                </div>
            </div>
        </div>
        
        <!-- 壁纸/锁屏 设置页面 -->
        <div id="wallpaper-settings-page" class="page">
            <header class="app-header">
                <div class="back-button" id="wallpaper-settings-back-button"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></svg></div>
                <h2 class="app-title">自定义壁纸/锁屏</h2>
            </header>
            <div class="app-content-area">
                <div class="settings-section">
                    <h3>桌面壁纸</h3>
                    <div class="control-group">
                        <button class="btn" id="upload-wallpaper-btn">上传本地图片</button>
                        <input type="file" id="wallpaper-file-input" accept="image/*" style="display:none;">
                    </div>
                    <div class="control-group">
                        <label for="wallpaper-url-input">输入图片URL</label>
                        <input type="text" id="wallpaper-url-input" class="input-field" placeholder="https://example.com/image.jpg">
                    </div>
                    <div id="wallpaper-preview-section">
                         <label>实时预览</label>
                        <div id="wallpaper-preview"></div>
                    </div>
                     <div class="control-group" style="margin-top:15px;">
                        <button class="btn btn-restore" id="restore-wallpaper-defaults">恢复默认</button>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>锁屏壁纸</h3>
                    <div class="control-group">
                        <button class="btn" id="upload-lockscreen-wallpaper-btn">上传本地图片</button>
                        <input type="file" id="lockscreen-wallpaper-file-input" accept="image/*" style="display:none;">
                    </div>
                    <div class="control-group">
                        <label for="lockscreen-wallpaper-url-input">输入图片URL</label>
                        <input type="text" id="lockscreen-wallpaper-url-input" class="input-field" placeholder="https://example.com/image.jpg">
                    </div>
                     <div id="lockscreen-wallpaper-preview-section">
                        <label>实时预览</label>
                        <div id="lockscreen-wallpaper-preview"></div>
                    </div>
                    <div class="control-group" style="margin-top:15px;">
                        <button class="btn btn-restore" id="restore-lockscreen-wallpaper-defaults">恢复默认 (纯白)</button>
                    </div>
                </div>
                 <div class="setting-card" id="to-lock-screen-settings-card">
                    <span>锁屏详细设置</span>
                    <span class="arrow">></span>
                </div>
            </div>
        </div>

        <!-- 锁屏详细设置页面 -->
        <div id="lock-screen-settings-page" class="page">
            <header class="app-header">
                <div class="back-button" id="lock-screen-settings-back-button"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></svg></div>
                <h2 class="app-title">锁屏详细设置</h2>
            </header>
            <div class="app-content-area">
                <div class="settings-section">
                    <h3>锁屏密码</h3>
                    <label class="toggle-label">
                        <span>启用锁屏密码</span>
                        <input type="checkbox" id="enable-passcode-toggle">
                    </label>
                    <div class="control-group">
                        <label for="passcode-input">设置6位密码</label>
                        <input type="number" id="passcode-input" class="input-field" placeholder="输入6位数字密码" maxlength="6">
                    </div>
                </div>
                <div class="settings-section">
                    <h3>日期与时钟</h3>
                    <div class="control-group">
                        <label for="lock-screen-date-format-input">日期样式</label>
                        <input type="text" id="lock-screen-date-format-input" class="input-field">
                    </div>
                    <div class="control-group">
                        <label for="lock-screen-clock-font-select">时钟字体</label>
                        <select id="lock-screen-clock-font-select" class="select-field">
                            <option value="-apple-system, BlinkMacSystemFont, 'San Francisco', 'Helvetica Neue', Arial, sans-serif">iOS 粗体 (默认)</option>
                            <option value="'Courier New', Courier, monospace">打字机体</option>
                            <option value="'Times New Roman', Times, serif">衬线体</option>
                            <option value="'Lucida Console', Monaco, monospace">终端体</option>
                        </select>
                    </div>
                </div>
                <div class="settings-section">
                    <button class="btn btn-restore" id="restore-lock-screen-settings-defaults">恢复默认</button>
                </div>
            </div>
        </div>
        
        <!-- 图标设置页面 -->
        <div id="icon-settings-page" class="page">
            <header class="app-header">
                <div class="back-button" id="icon-settings-back-button"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></svg></div>
                <h2 class="app-title">图标设置</h2>
            </header>
            <div class="app-content-area">
                <div class="settings-section">
                    <div id="app-icon-controls"></div>
                </div>
                <div class="settings-section">
                    <button class="btn btn-restore" id="restore-icon-defaults">恢复默认</button>
                </div>
            </div>
        </div>
        
        <!-- 主题色设置页面 -->
        <div id="theme-settings-page" class="page">
            <header class="app-header">
                <div class="back-button" id="theme-settings-back-button"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></svg></div>
                <h2 class="app-title">主题色设置</h2>
            </header>
            <div class="app-content-area">
                <div class="settings-section">
                    <h3>实时预览</h3>
                    <div id="theme-color-preview"></div>
                </div>
                <div class="settings-section">
                    <h3>输入色号 (HEX)</h3>
                    <div class="control-group">
                         <input type="text" id="theme-color-hex" class="input-field" value="#e8f0e9">
                    </div>
                </div>
                <div class="settings-section">
                    <button class="btn btn-restore" id="restore-theme-defaults">恢复默认</button>
                </div>
            </div>
        </div>

        <!-- 底部栏设置页面 -->
        <div id="dock-settings-page" class="page">
            <header class="app-header">
                <div class="back-button" id="dock-settings-back-button"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></svg></div>
                <h2 class="app-title">底部栏设置</h2>
            </header>
            <div class="app-content-area">
                <div class="settings-section">
                    <h3>选项</h3>
                    <label class="toggle-label">
                        <span>使用纯白/透明底部栏 (不跟随主题色)</span>
                        <input type="checkbox" id="dock-white-bg-toggle">
                    </label>
                </div>
                <div class="settings-section">
                    <h3>透明度</h3>
                    <div class="control-group">
                        <div class="slider-container">
                            <span style="font-size: 0.8em;">透明</span>
                            <input type="range" id="dock-opacity-slider" min="0" max="1" step="0.05" value="0.85">
                            <span style="font-size: 0.8em;">不透明</span>
                        </div>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>实时预览</h3>
                    <div id="dock-preview" style="height: 60px; border-radius: 20px; transition: background-color 0.3s; display: flex; align-items: center; justify-content: space-around; padding: 0 20px; border: 1px solid var(--text-light);">
                        <div style="width: 40px; height: 40px; background-color: rgba(255,255,255,0.5); border-radius: 10px;"></div>
                        <div style="width: 40px; height: 40px; background-color: rgba(255,255,255,0.5); border-radius: 10px;"></div>
                        <div style="width: 40px; height: 40px; background-color: rgba(255,255,255,0.5); border-radius: 10px;"></div>
                        <div style="width: 40px; height: 40px; background-color: rgba(255,255,255,0.5); border-radius: 10px;"></div>
                    </div>
                </div>
                <div class="settings-section">
                    <button class="btn btn-restore" id="restore-dock-defaults">恢复默认</button>
                </div>
            </div>
        </div>

        <!-- 头像框设置页面 -->
        <div id="avatar-frame-settings-page" class="page">
            <header class="app-header">
                <div class="back-button" id="avatar-frame-settings-back-button"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></svg></div>
                <h2 class="app-title">头像框设置</h2>
            </header>
            <div class="app-content-area">
                <div class="settings-section">
                    <h3>选项</h3>
                    <label class="toggle-label">
                        <span>启用头像框</span>
                        <input type="checkbox" id="enable-avatar-frame-toggle">
                    </label>
                </div>
                <div class="settings-section">
                    <h3>自定义头像框</h3>
                    <div class="control-group">
                        <button class="btn" id="upload-avatar-frame-btn">上传本地图片 (PNG/GIF)</button>
                        <input type="file" id="avatar-frame-file-input" accept="image/png,image/gif" style="display:none;">
                    </div>
                    <div class="control-group">
                        <label for="avatar-frame-url-input">或输入图片URL</label>
                        <input type="text" id="avatar-frame-url-input" class="input-field" placeholder="https://.../frame.gif">
                    </div>
                </div>
                <div class="settings-section">
                    <h3>位置与大小微调</h3>
                    <div class="control-group">
                        <label for="avatar-frame-x-slider">水平位置 (X)</label>
                        <div class="slider-container">
                            <span>-</span>
                            <input type="range" id="avatar-frame-x-slider" min="-20" max="20" value="0" step="1">
                            <span>+</span>
                        </div>
                    </div>
                     <div class="control-group">
                        <label for="avatar-frame-y-slider">垂直位置 (Y)</label>
                        <div class="slider-container">
                            <span>-</span>
                            <input type="range" id="avatar-frame-y-slider" min="-20" max="20" value="0" step="1">
                            <span>+</span>
                        </div>
                    </div>
                     <div class="control-group">
                        <label for="avatar-frame-scale-slider">缩放大小</label>
                        <div class="slider-container">
                            <span>小</span>
                            <input type="range" id="avatar-frame-scale-slider" min="0.8" max="1.5" value="1" step="0.01">
                            <span>大</span>
                        </div>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>实时预览</h3>
                    <div class="avatar-frame-preview">
                        <div id="preview-avatar" class="avatar"></div>
                        <div id="preview-avatar-frame"></div>
                    </div>
                </div>
                <div class="settings-section">
                    <button class="btn btn-restore" id="restore-avatar-frame-defaults">恢复默认</button>
                </div>
            </div>
        </div>

    </div>

    <div class="modal-overlay" id="edit-modal">
        <div class="modal-content">
            <h3 id="modal-title">编辑信息</h3>
            <textarea id="modal-input" class="modal-input" rows="3"></textarea>
            <div class="modal-actions">
                <button class="modal-button cancel" id="modal-cancel">取消</button>
                <button class="modal-button save" id="modal-save">保存</button>
            </div>
        </div>
    </div>
    
    <!-- 锁屏 & 密码输入界面 -->
    <div id="lock-screen">
        <div class="lock-screen-content">
            <div id="lock-screen-time"></div>
            <div id="lock-screen-date"></div>
        </div>
        <div class="lock-screen-unlock-hint">向上滑动解锁</div>
    </div>

    <div id="passcode-screen">
        <div class="passcode-container">
            <div class="passcode-title">输入密码</div>
            <div class="passcode-dots">
                <div class="passcode-dot"></div><div class="passcode-dot"></div><div class="passcode-dot"></div>
                <div class="passcode-dot"></div><div class="passcode-dot"></div><div class="passcode-dot"></div>
            </div>
            <div class="passcode-keyboard">
                <button class="keyboard-btn" data-key="1">1</button>
                <button class="keyboard-btn" data-key="2">2</button>
                <button class="keyboard-btn" data-key="3">3</button>
                <button class="keyboard-btn" data-key="4">4</button>
                <button class="keyboard-btn" data-key="5">5</button>
                <button class="keyboard-btn" data-key="6">6</button>
                <button class="keyboard-btn" data-key="7">7</button>
                <button class="keyboard-btn" data-key="8">8</button>
                <button class="keyboard-btn" data-key="9">9</button>
                <div></div>
                <button class="keyboard-btn" data-key="0">0</button>
                <button class="keyboard-btn delete" data-key="del">⌫</button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const appContainer = document.querySelector('.app-container');
            appContainer.style.height = `${window.innerHeight}px`;

            const pages = {
                desktop: document.getElementById('desktop-page'),
                beautify: document.getElementById('beautify-page'),
                fontSettings: document.getElementById('font-settings-page'),
                wallpaperSettings: document.getElementById('wallpaper-settings-page'),
                iconSettings: document.getElementById('icon-settings-page'),
                themeSettings: document.getElementById('theme-settings-page'),
                dockSettings: document.getElementById('dock-settings-page'),
                avatarFrameSettings: document.getElementById('avatar-frame-settings-page'),
                lockScreenSettings: document.getElementById('lock-screen-settings-page'),
            };

            const navigation = {
                toBeautify: document.getElementById('beautify-app-icon'),
                backFromBeautify: document.getElementById('beautify-back-button'),
                toFontSettings: document.getElementById('font-settings-card'),
                backFromFontSettings: document.getElementById('font-settings-back-button'),
                toWallpaperSettings: document.getElementById('wallpaper-settings-card'),
                backFromWallpaperSettings: document.getElementById('wallpaper-settings-back-button'),
                toIconSettings: document.getElementById('icon-settings-card'),
                backFromIconSettings: document.getElementById('icon-settings-back-button'),
                toThemeSettings: document.getElementById('theme-settings-card'),
                backFromThemeSettings: document.getElementById('theme-settings-back-button'),
                toDockSettings: document.getElementById('dock-settings-card'),
                backFromDockSettings: document.getElementById('dock-settings-back-button'),
                toAvatarFrameSettings: document.getElementById('avatar-frame-settings-card'),
                backFromAvatarFrameSettings: document.getElementById('avatar-frame-settings-back-button'),
                toLockScreenSettings: document.getElementById('to-lock-screen-settings-card'),
                backFromLockScreenSettings: document.getElementById('lock-screen-settings-back-button'),
            };

            function showPage(pageToShow) {
                Object.values(pages).forEach(p => p.classList.remove('active'));
                pageToShow.classList.add('active');
            }

            navigation.toBeautify.addEventListener('click', () => showPage(pages.beautify));
            navigation.backFromBeautify.addEventListener('click', () => showPage(pages.desktop));
            navigation.toFontSettings.addEventListener('click', () => showPage(pages.fontSettings));
            navigation.backFromFontSettings.addEventListener('click', () => showPage(pages.beautify));
            navigation.toWallpaperSettings.addEventListener('click', () => showPage(pages.wallpaperSettings));
            navigation.backFromWallpaperSettings.addEventListener('click', () => showPage(pages.beautify));
            navigation.toIconSettings.addEventListener('click', () => showPage(pages.iconSettings));
            navigation.backFromIconSettings.addEventListener('click', () => showPage(pages.beautify));
            navigation.toThemeSettings.addEventListener('click', () => showPage(pages.themeSettings));
            navigation.backFromThemeSettings.addEventListener('click', () => showPage(pages.beautify));
            navigation.toDockSettings.addEventListener('click', () => showPage(pages.dockSettings));
            navigation.backFromDockSettings.addEventListener('click', () => showPage(pages.beautify));
            navigation.toAvatarFrameSettings.addEventListener('click', () => showPage(pages.avatarFrameSettings));
            navigation.backFromAvatarFrameSettings.addEventListener('click', () => showPage(pages.beautify));
            navigation.toLockScreenSettings.addEventListener('click', () => showPage(pages.lockScreenSettings));
            navigation.backFromLockScreenSettings.addEventListener('click', () => showPage(pages.wallpaperSettings));
            
            let currentAvatarFrameURL = null;

            // --- 字体设置 ---
            const fontControls = { cssInput: document.getElementById('font-css-input'), sizeSlider: document.getElementById('font-size-slider'), weightSlider: document.getElementById('font-weight-slider'), previewDetails: document.getElementById('font-details'), dynamicStyle: document.getElementById('dynamic-font-style'), fontLinkContainer: document.getElementById('font-link-container'), restoreBtn: document.getElementById('restore-font-defaults') };
            let currentFontName = 'KingHwaOldSong';
            const defaultCssContent = `<link rel="preload" as="style" crossorigin href="https://fontsapi.zeoseven.com/309/main/result.css" onload="this.rel='stylesheet'" onerror="this.href='httpsapi-storage.zeoseven.com/309/main/result.css'" />\n<noscript>\n    <link rel="stylesheet" href="https://fontsapi.zeoseven.com/309/main/result.css" />\n</noscript>\n<style>\n    body { font-family: "KingHwaOldSong"; }\n</style>`;
            fontControls.cssInput.value = defaultCssContent;
            function updateGlobalStyle(property, value) { document.documentElement.style.setProperty(property, value); updateFontPreview(); }
            function updateFontPreview() { const size = fontControls.sizeSlider.value + 'px'; const weight = fontControls.weightSlider.value; fontControls.previewDetails.textContent = `${currentFontName} / ${size} / ${weight}`; }
            document.getElementById('upload-font-btn').addEventListener('click', () => document.getElementById('font-file-input').click());
            document.getElementById('font-file-input').addEventListener('change', (event) => { const file = event.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = (e) => { const fontName = 'CustomLocalFont'; fontControls.dynamicStyle.innerHTML = `@font-face { font-family: '${fontName}'; src: url('${e.target.result}'); }`; currentFontName = fontName; updateGlobalStyle('--font-main', `'${fontName}', sans-serif`); }; reader.readAsDataURL(file); });
            fontControls.cssInput.addEventListener('input', () => { fontControls.fontLinkContainer.innerHTML = fontControls.cssInput.value; const match = fontControls.cssInput.value.match(/font-family:\s*["']?([^;"']+)["']?/); if (match && match[1]) { currentFontName = match[1]; updateGlobalStyle('--font-main', match[1]); } });
            document.getElementById('font-url-input').addEventListener('input', (e) => { const url = e.target.value.trim(); if (!url) return; const fontName = 'CustomUrlFont'; fontControls.dynamicStyle.innerHTML = `@font-face { font-family: '${fontName}'; src: url('${url}'); }`; currentFontName = fontName; updateGlobalStyle('--font-main', `'${fontName}', sans-serif`); });
            fontControls.sizeSlider.addEventListener('input', () => updateGlobalStyle('--global-font-size', fontControls.sizeSlider.value + 'px'));
            fontControls.weightSlider.addEventListener('input', () => updateGlobalStyle('--global-font-weight', fontControls.weightSlider.value));
            fontControls.restoreBtn.addEventListener('click', () => { currentFontName = 'KingHwaOldSong'; fontControls.cssInput.value = defaultCssContent; fontControls.fontLinkContainer.innerHTML = defaultCssContent; fontControls.dynamicStyle.innerHTML = ''; fontControls.sizeSlider.value = 16; fontControls.weightSlider.value = 400; updateGlobalStyle('--font-main', '"KingHwaOldSong", sans-serif'); updateGlobalStyle('--global-font-size', '16px'); updateGlobalStyle('--global-font-weight', '400'); });

            // --- 壁纸设置 ---
            const wallpaperControls = { previewElement: document.getElementById('wallpaper-preview'), urlInput: document.getElementById('wallpaper-url-input'), restoreBtn: document.getElementById('restore-wallpaper-defaults') };
            function applyWallpaper(imageUrl) { const urlString = imageUrl ? `url('${imageUrl}')` : 'none'; document.body.style.backgroundImage = urlString; wallpaperControls.previewElement.style.backgroundImage = urlString; localStorage.setItem('desktopWallpaper', imageUrl || ''); }
            document.getElementById('upload-wallpaper-btn').addEventListener('click', () => document.getElementById('wallpaper-file-input').click());
            document.getElementById('wallpaper-file-input').addEventListener('change', (event) => { const file = event.target.files[0]; if (file) { const reader = new FileReader(); reader.onload = (e) => applyWallpaper(e.target.result); reader.readAsDataURL(file); } });
            wallpaperControls.urlInput.addEventListener('input', (e) => applyWallpaper(e.target.value.trim()));
            wallpaperControls.restoreBtn.addEventListener('click', () => { applyWallpaper(null); wallpaperControls.urlInput.value = ''; });
            const savedWallpaper = localStorage.getItem('desktopWallpaper'); if (savedWallpaper) { applyWallpaper(savedWallpaper); wallpaperControls.urlInput.value = savedWallpaper; }


            // --- 图标设置 ---
            const iconControlsContainer = document.getElementById('app-icon-controls');
            const iconGroups = [ { title: 'App', count: 4, prefix: 'app-icon-' }, { title: '底部栏图标', count: 4, prefix: 'dock-icon-' } ];
            iconGroups.forEach(group => { for (let i = 1; i <= group.count; i++) { const controlHtml = `<div class="icon-setting-group"><h4>${group.title} ${i} 图标</h4><div class="control-group"><button class="btn" data-target="${group.prefix}${i}">上传</button><input type="file" data-target="${group.prefix}${i}" accept="image/*" style="display:none;"><input type="text" data-target="${group.prefix}${i}" class="input-field" placeholder="或输入图片URL"></div></div>`; iconControlsContainer.innerHTML += controlHtml; } });
            iconControlsContainer.addEventListener('click', (e) => { if (e.target.tagName === 'BUTTON') { const targetId = e.target.dataset.target; iconControlsContainer.querySelector(`input[type="file"][data-target="${targetId}"]`).click(); } });
            iconControlsContainer.addEventListener('change', (e) => { if (e.target.type === 'file') { const file = e.target.files[0]; const targetId = e.target.dataset.target; if (file) { const reader = new FileReader(); reader.onload = (re) => { const iconEl = document.getElementById(targetId); iconEl.style.backgroundImage = `url('${re.target.result}')`; iconEl.style.backgroundColor = 'transparent'; }; reader.readAsDataURL(file); } } });
            iconControlsContainer.addEventListener('input', (e) => { if (e.target.type === 'text') { const url = e.target.value.trim(); const targetId = e.target.dataset.target; const iconEl = document.getElementById(targetId); if (url) { iconEl.style.backgroundImage = `url('${url}')`; iconEl.style.backgroundColor = 'transparent'; } else { iconEl.style.backgroundImage = 'none'; iconEl.style.backgroundColor = '#fff'; } } });
            document.getElementById('restore-icon-defaults').addEventListener('click', () => { iconControlsContainer.querySelectorAll('input[type="text"]').forEach(input => input.value = ''); iconGroups.forEach(group => { for (let i = 1; i <= group.count; i++) { const iconEl = document.getElementById(`${group.prefix}${i}`); iconEl.style.backgroundImage = 'none'; iconEl.style.backgroundColor = '#fff'; } }); });

            // --- 主题色设置 ---
            const themeControls = { preview: document.getElementById('theme-color-preview'), hexInput: document.getElementById('theme-color-hex'), restoreBtn: document.getElementById('restore-theme-defaults') };
            const defaultThemeColor = '#e8f0e9';
            function hexToRgba(hex, alpha = 1) { let r = 0, g = 0, b = 0; if (hex.length == 4) { r = parseInt(hex[1] + hex[1], 16); g = parseInt(hex[2] + hex[2], 16); b = parseInt(hex[3] + hex[3], 16); } else if (hex.length == 7) { r = parseInt(hex.slice(1, 3), 16); g = parseInt(hex.slice(3, 5), 16); b = parseInt(hex.slice(5, 7), 16); } return `rgba(${r}, ${g}, ${b}, ${alpha})`; }
            function applyThemeColor(color) { document.documentElement.style.setProperty('--placeholder-bg', color); themeControls.preview.style.backgroundColor = color; updateDockAppearance(); }
            themeControls.hexInput.addEventListener('input', (e) => { const newColor = e.target.value; if (/^#([0-9A-F]{3}){1,2}$/i.test(newColor)) { applyThemeColor(newColor); } });
            themeControls.restoreBtn.addEventListener('click', () => { themeControls.hexInput.value = defaultThemeColor; applyThemeColor(defaultThemeColor); });

            // --- 底部栏设置 ---
            const dockControls = { whiteBgToggle: document.getElementById('dock-white-bg-toggle'), opacitySlider: document.getElementById('dock-opacity-slider'), previewBox: document.getElementById('dock-preview'), restoreBtn: document.getElementById('restore-dock-defaults') };
            const defaultDockOpacity = 0.85;
            function updateDockAppearance() { const opacity = dockControls.opacitySlider.value; const isWhite = dockControls.whiteBgToggle.checked; const themeColor = getComputedStyle(document.documentElement).getPropertyValue('--placeholder-bg').trim(); const baseHex = isWhite ? '#ffffff' : themeColor; const newDockColor = hexToRgba(baseHex, opacity); document.documentElement.style.setProperty('--dock-bg', newDockColor); dockControls.previewBox.style.backgroundColor = newDockColor; }
            dockControls.whiteBgToggle.addEventListener('change', updateDockAppearance);
            dockControls.opacitySlider.addEventListener('input', updateDockAppearance);
            dockControls.restoreBtn.addEventListener('click', () => { dockControls.whiteBgToggle.checked = false; dockControls.opacitySlider.value = defaultDockOpacity; updateDockAppearance(); });

            // --- 头像框设置 ---
            const avatarFrameControls = { toggle: document.getElementById('enable-avatar-frame-toggle'), uploadBtn: document.getElementById('upload-avatar-frame-btn'), fileInput: document.getElementById('avatar-frame-file-input'), urlInput: document.getElementById('avatar-frame-url-input'), restoreBtn: document.getElementById('restore-avatar-frame-defaults'), mainFrame: document.getElementById('avatar-frame-overlay'), previewFrame: document.getElementById('preview-avatar-frame'), mainAvatar: document.getElementById('avatar-container'), previewAvatar: document.getElementById('preview-avatar'), xSlider: document.getElementById('avatar-frame-x-slider'), ySlider: document.getElementById('avatar-frame-y-slider'), scaleSlider: document.getElementById('avatar-frame-scale-slider') };
            function applyAvatarFrame() { const isEnabled = avatarFrameControls.toggle.checked; const imageUrl = avatarFrameControls.urlInput.value.trim(); const frameElements = [avatarFrameControls.mainFrame, avatarFrameControls.previewFrame]; const avatarElements = [avatarFrameControls.mainAvatar, avatarFrameControls.previewAvatar]; avatarElements.forEach(el => el.classList.toggle('avatar-framed', isEnabled)); frameElements.forEach(el => { el.style.backgroundImage = 'none'; el.style.boxShadow = 'none'; if (isEnabled) { if (imageUrl) { el.style.backgroundImage = `url('${imageUrl}')`; } else { el.style.boxShadow = '0 0 0 3px white, 0 4px 10px rgba(0,0,0,0.15)'; } } }); }
            function applyAvatarFrameTransform() { const x = avatarFrameControls.xSlider.value; const y = avatarFrameControls.ySlider.value; const scale = avatarFrameControls.scaleSlider.value; const transformValue = `translate(${x}px, ${y}px) scale(${scale})`; [avatarFrameControls.mainFrame, avatarFrameControls.previewFrame].forEach(el => { el.style.transform = transformValue; }); }
            avatarFrameControls.toggle.addEventListener('change', applyAvatarFrame);
            avatarFrameControls.uploadBtn.addEventListener('click', () => avatarFrameControls.fileInput.click());
            avatarFrameControls.fileInput.addEventListener('change', (event) => { const file = event.target.files[0]; if (file) { if (currentAvatarFrameURL) URL.revokeObjectURL(currentAvatarFrameURL); currentAvatarFrameURL = URL.createObjectURL(file); avatarFrameControls.urlInput.value = currentAvatarFrameURL; applyAvatarFrame(); } });
            avatarFrameControls.urlInput.addEventListener('input', () => { if (currentAvatarFrameURL && !avatarFrameControls.urlInput.value.startsWith('blob:')) { URL.revokeObjectURL(currentAvatarFrameURL); currentAvatarFrameURL = null; } applyAvatarFrame(); });
            avatarFrameControls.xSlider.addEventListener('input', applyAvatarFrameTransform);
            avatarFrameControls.ySlider.addEventListener('input', applyAvatarFrameTransform);
            avatarFrameControls.scaleSlider.addEventListener('input', applyAvatarFrameTransform);
            avatarFrameControls.restoreBtn.addEventListener('click', () => { avatarFrameControls.toggle.checked = false; avatarFrameControls.urlInput.value = ''; avatarFrameControls.fileInput.value = ''; avatarFrameControls.xSlider.value = 0; avatarFrameControls.ySlider.value = 0; avatarFrameControls.scaleSlider.value = 1; if (currentAvatarFrameURL) { URL.revokeObjectURL(currentAvatarFrameURL); currentAvatarFrameURL = null; } applyAvatarFrame(); applyAvatarFrameTransform(); });

            // --- 锁屏核心逻辑 ---
            const lockScreen = document.getElementById('lock-screen');
            const passcodeScreen = document.getElementById('passcode-screen');
            const lockScreenTime = document.getElementById('lock-screen-time');
            const lockScreenDate = document.getElementById('lock-screen-date');
            
            const lockScreenControls = {
                wallpaperUrlInput: document.getElementById('lockscreen-wallpaper-url-input'),
                wallpaperPreview: document.getElementById('lockscreen-wallpaper-preview'),
                restoreWallpaperBtn: document.getElementById('restore-lockscreen-wallpaper-defaults'),
                enablePasscodeToggle: document.getElementById('enable-passcode-toggle'),
                passcodeInput: document.getElementById('passcode-input'),
                dateFormatInput: document.getElementById('lock-screen-date-format-input'),
                clockFontSelect: document.getElementById('lock-screen-clock-font-select'),
                restoreSettingsBtn: document.getElementById('restore-lock-screen-settings-defaults'),
            };

            const defaultLockScreenSettings = {
                wallpaper: '',
                passcodeEnabled: false,
                passcode: '',
                dateFormat: 'x月x日星期x 农历时间',
                clockFont: "-apple-system, BlinkMacSystemFont, 'San Francisco', 'Helvetica Neue', Arial, sans-serif",
            };

            let lockScreenSettings = JSON.parse(localStorage.getItem('lockScreenSettings')) || { ...defaultLockScreenSettings };

            function saveLockScreenSettings() {
                localStorage.setItem('lockScreenSettings', JSON.stringify(lockScreenSettings));
            }

            function applyLockScreenWallpaper(imageUrl) {
                const urlString = imageUrl ? `url('${imageUrl}')` : 'none';
                lockScreen.style.backgroundImage = urlString;
                lockScreen.style.backgroundColor = imageUrl ? 'transparent' : '#ffffff';
                lockScreenControls.wallpaperPreview.style.backgroundImage = urlString;
                lockScreenControls.wallpaperPreview.style.backgroundColor = imageUrl ? 'transparent' : '#ffffff';
                lockScreenSettings.wallpaper = imageUrl || '';
                saveLockScreenSettings();
            }

            function applyLockScreenStyle() {
                lockScreenTime.style.fontFamily = lockScreenSettings.clockFont;
            }

            document.getElementById('upload-lockscreen-wallpaper-btn').addEventListener('click', () => document.getElementById('lockscreen-wallpaper-file-input').click());
            document.getElementById('lockscreen-wallpaper-file-input').addEventListener('change', (event) => { const file = event.target.files[0]; if (file) { const reader = new FileReader(); reader.onload = (e) => applyLockScreenWallpaper(e.target.result); reader.readAsDataURL(file); } });
            lockScreenControls.wallpaperUrlInput.addEventListener('input', (e) => applyLockScreenWallpaper(e.target.value.trim()));
            lockScreenControls.restoreWallpaperBtn.addEventListener('click', () => { applyLockScreenWallpaper(''); lockScreenControls.wallpaperUrlInput.value = ''; });

            lockScreenControls.enablePasscodeToggle.addEventListener('change', (e) => { lockScreenSettings.passcodeEnabled = e.target.checked; saveLockScreenSettings(); });
            lockScreenControls.passcodeInput.addEventListener('input', (e) => { if (e.target.value.length > 6) e.target.value = e.target.value.slice(0, 6); });
            lockScreenControls.passcodeInput.addEventListener('change', (e) => { lockScreenSettings.passcode = e.target.value; saveLockScreenSettings(); });
            lockScreenControls.dateFormatInput.addEventListener('input', (e) => { lockScreenSettings.dateFormat = e.target.value; saveLockScreenSettings(); });
            lockScreenControls.clockFontSelect.addEventListener('change', (e) => { lockScreenSettings.clockFont = e.target.value; saveLockScreenSettings(); applyLockScreenStyle(); });
            
            lockScreenControls.restoreSettingsBtn.addEventListener('click', () => {
                lockScreenSettings = { ...defaultLockScreenSettings, wallpaper: lockScreenSettings.wallpaper }; // Keep wallpaper
                saveLockScreenSettings();
                loadLockScreenSettings();
                applyLockScreenStyle();
            });

            function loadLockScreenSettings() {
                applyLockScreenWallpaper(lockScreenSettings.wallpaper);
                lockScreenControls.wallpaperUrlInput.value = lockScreenSettings.wallpaper;
                lockScreenControls.enablePasscodeToggle.checked = lockScreenSettings.passcodeEnabled;
                lockScreenControls.passcodeInput.value = lockScreenSettings.passcode;
                lockScreenControls.dateFormatInput.value = lockScreenSettings.dateFormat;
                lockScreenControls.clockFontSelect.value = lockScreenSettings.clockFont;
            }

            // Unlock Logic
            let touchStartY = 0;
            lockScreen.addEventListener('touchstart', (e) => { touchStartY = e.touches[0].clientY; }, { passive: true });
            lockScreen.addEventListener('touchend', (e) => {
                const touchEndY = e.changedTouches[0].clientY;
                if (touchStartY - touchEndY > 50) { // Swiped up
                    if (lockScreenSettings.passcodeEnabled && lockScreenSettings.passcode) {
                        lockScreen.classList.add('hidden');
                        passcodeScreen.classList.add('visible');
                    } else {
                        unlockDevice();
                    }
                }
            }, { passive: true });
            
            function unlockDevice() {
                lockScreen.classList.add('hidden');
                passcodeScreen.classList.remove('visible');
                document.body.style.overflow = 'auto';
                pages.desktop.classList.add('active'); // Ensure desktop is active
                setTimeout(() => { lockScreen.style.display = 'none'; }, 300); // Hide for performance
            }

            // Passcode Logic
            const passcodeDots = passcodeScreen.querySelectorAll('.passcode-dot');
            let currentPasscodeInput = '';
            passcodeScreen.querySelector('.passcode-keyboard').addEventListener('click', (e) => {
                if (!e.target.classList.contains('keyboard-btn')) return;
                const key = e.target.dataset.key;
                if (key === 'del') {
                    currentPasscodeInput = currentPasscodeInput.slice(0, -1);
                } else if (currentPasscodeInput.length < 6) {
                    currentPasscodeInput += key;
                }
                updatePasscodeDots();
                if (currentPasscodeInput.length === 6) {
                    checkPasscode();
                }
            });

            function updatePasscodeDots() {
                passcodeDots.forEach((dot, index) => {
                    dot.classList.toggle('filled', index < currentPasscodeInput.length);
                });
            }

            function checkPasscode() {
                if (currentPasscodeInput === lockScreenSettings.passcode) {
                    setTimeout(unlockDevice, 200);
                } else {
                    passcodeScreen.classList.add('shake');
                    setTimeout(() => {
                        passcodeScreen.classList.remove('shake');
                        currentPasscodeInput = '';
                        updatePasscodeDots();
                    }, 500);
                }
            }
            
            // Date & Time Update
            function updateLockScreenDateTime() {
                const now = new Date();
                lockScreenTime.textContent = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
                lockScreenDate.textContent = formatDate(now, lockScreenSettings.dateFormat);
            }

            function formatDate(date, format) {
                const weekdays = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
                let formatted = format.replace('x月', date.getMonth() + 1)
                                      .replace('x日', date.getDate())
                                      .replace('星期x', weekdays[date.getDay()]);
                if (formatted.includes('农历时间')) {
                    formatted = formatted.replace('农历时间', getLunarDate(date));
                }
                return formatted;
            }
            
            function getLunarDate(date) { // Simplified Lunar Date
                const lunarData = ['甲子', '乙丑', '丙寅', '丁卯', '戊辰', '己巳', '庚午', '辛未', '壬申', '癸酉', '甲戌', '乙亥', '丙子', '丁丑', '戊寅', '己卯', '庚辰', '辛巳', '壬午', '癸未', '甲申', '乙酉', '丙戌', '丁亥', '戊子', '己丑', '庚寅', '辛卯', '壬辰', '癸巳', '甲午', '乙未', '丙申', '丁酉', '戊戌', '己亥', '庚子', '辛丑', '壬寅', '癸卯', '甲辰', '乙巳', '丙午', '丁未', '戊申', '己酉', '庚戌', '辛亥', '壬子', '癸丑', '甲寅', '乙卯', '丙辰', '丁巳', '戊午', '己未', '庚申', '辛酉', '壬戌', '癸亥'];
                const lunarMonths = ['正月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '冬月', '腊月'];
                const lunarDays = ['初一', '初二', '初三', '初四', '初五', '初六', '初七', '初八', '初九', '初十', '十一', '十二', '十三', '十四', '十五', '十六', '十七', '十八', '十九', '二十', '廿一', '廿二', '廿三', '廿四', '廿五', '廿六', '廿七', '廿八', '廿九', '三十'];
                // This is a placeholder, a real conversion is much more complex
                const dayOfYear = Math.floor((date - new Date(date.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
                return `${lunarData[date.getFullYear() % 60]}年 ${lunarMonths[date.getMonth()]} ${lunarDays[date.getDate() - 1]}`;
            }

            // --- 原有JS及初始化 ---
            updateTime(); setInterval(updateTime, 30000);
            updateBatteryStatus();
            
            function updateAvatarImages(imageUrl) {
                document.getElementById('avatar-container').style.backgroundImage = `url('${imageUrl}')`;
                document.getElementById('preview-avatar').style.backgroundImage = `url('${imageUrl}')`;
            }

            function setupImageUpload(triggerId, inputId, callback) {
                const trigger = document.getElementById(triggerId);
                const input = document.getElementById(inputId);
                trigger.addEventListener('click', () => input.click());
                input.addEventListener('change', (event) => {
                    const file = event.target.files[0];
                    if (file) {
                        const objectURL = URL.createObjectURL(file);
                        callback(objectURL);
                    }
                });
            }
            setupImageUpload('avatar-container', 'avatar-upload', updateAvatarImages);
            setupImageUpload('profile-banner', 'banner-upload', (result) => document.getElementById('profile-banner').style.backgroundImage = `url('${result}')`);
            setupImageUpload('widget-left', 'widget-left-upload', (result) => document.getElementById('widget-left').style.backgroundImage = `url('${result}')`);

            const modal = { overlay: document.getElementById('edit-modal'), title: document.getElementById('modal-title'), input: document.getElementById('modal-input'), save: document.getElementById('modal-save'), cancel: document.getElementById('modal-cancel') };
            let currentEditingElement = null;
            function openModal(element, title) { currentEditingElement = element; modal.title.textContent = title; modal.input.value = element.textContent; modal.overlay.classList.add('visible'); modal.input.focus(); }
            function closeModal() { modal.overlay.classList.remove('visible'); }
            modal.save.addEventListener('click', () => { if (currentEditingElement) currentEditingElement.textContent = modal.input.value; closeModal(); });
            modal.cancel.addEventListener('click', closeModal);
            modal.overlay.addEventListener('click', (e) => { if (e.target === modal.overlay) closeModal(); });
            document.querySelector('.nickname').addEventListener('click', (e) => openModal(e.target, '编辑昵称'));
            document.querySelector('.username').addEventListener('click', (e) => openModal(e.target, '编辑ID'));
            document.querySelector('.bio').addEventListener('click', (e) => openModal(e.target, '编辑签名'));
            document.querySelector('.location span').addEventListener('click', (e) => openModal(e.target, '编辑地点'));
            
            // 初始化
            showPage(pages.desktop); // Start at desktop, but lockscreen will overlay it
            lockScreen.classList.remove('hidden');
            lockScreen.style.display = 'flex';
            
            updateFontPreview();
            applyThemeColor(themeControls.hexInput.value);
            applyAvatarFrame();
            applyAvatarFrameTransform();
            
            loadLockScreenSettings();
            applyLockScreenStyle();
            updateLockScreenDateTime();
            setInterval(updateLockScreenDateTime, 1000); // Update lock screen time every second
        });

        function updateBatteryStatus() { if ('getBattery' in navigator) { navigator.getBattery().then(function(battery) { const container = document.getElementById('battery-container'); function updateAll() { container.classList.toggle('battery-charging', battery.charging); container.classList.toggle('battery-low', !battery.charging && battery.level <= 0.2); updateBatteryLevel(battery.level); } updateAll(); battery.addEventListener('chargingchange', updateAll); battery.addEventListener('levelchange', updateAll); }); } else { updateBatteryLevel(0.88); } }
        function updateBatteryLevel(level) { const fill = document.getElementById('battery-fill'); if(fill) fill.setAttribute('width', String(Math.max(2, Math.floor(22 * level)))); }
        function updateTime() { const now = new Date(); const timeDisplay = document.getElementById('current-time'); if (timeDisplay) timeDisplay.textContent = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`; }
    </script>
</body>
</html>